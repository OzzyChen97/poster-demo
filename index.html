<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- 這行對於手機瀏覽至關重要 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The 'Nightmare Problem' Builder</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for the demo */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Define colors for IN (✅) and OUT (❌) */
        .cell-in {
            background-color: #166534; /* green-800 */
            color: #dcfce7; /* green-100 */
        }
        .cell-out {
            background-color: #991b1b; /* red-800 */
            color: #fee2e2; /* red-100 */
        }
        .cell-empty {
            background-color: #374151; /* gray-700 */
        }

        /* Animation for the currently active diagonal cell */
        .diagonal-active {
            position: relative; /* 確保 z-index 生效 */
            box-shadow: 0 0 15px 5px #3b82f6; /* blue-500 glow */
            transform: scale(1.1);
            z-index: 10;
        }
        
        /* Animation for the prompt text */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .prompt-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* Animation for a wrong button press */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-black text-gray-200 min-h-screen flex items-center justify-center p-2 sm:p-4">

    <!-- 響應式：手機上 p-2, 桌面上 p-6。新增 overflow-hidden -->
    <div id="app" class="w-full max-w-3xl mx-auto p-2 sm:p-6 bg-gray-900 rounded-2xl shadow-2xl overflow-hidden">
        
        <!-- Act 1: The Setup -->
        <div id="setup">
            <!-- 響應式：手機上 text-2xl, 桌面上 text-3xl -->
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-white mb-4">The 'Nightmare Problem' Builder</h1>
            <!-- 響應式：手機上 text-base, 桌面上 text-lg -->
            <p class="text-center text-base sm:text-lg text-gray-400 mb-6">Let's assume we can list *all* possible "Yes/No" problems.<br>Each problem is just a list of numbers it says "Yes" to (which we'll call <span class="text-green-400 font-semibold">IN</span>).</p>
        </div>

        <!-- Act 2: The Grid -->
        <!-- 新增 min-w-0 輔助收縮 -->
        <div id="list-container" class="mb-6 min-w-0">
            <!-- 響應式：手機上 40px, 桌面上 60px -->
            <div class="grid gap-1 min-w-0" id="grid-header" style="grid-template-columns: 40px sm:60px repeat(5, 1fr);">
                <!-- 響應式：手機上 p-1 text-xs, 桌面上 p-2 text-sm -->
                <div class="p-1 sm:p-2 font-semibold text-center text-gray-400 text-xs sm:text-sm">List #</div>
                <div class="p-1 sm:p-2 font-semibold text-center text-gray-400 text-xs sm:text-sm">Num 1</div>
                <div class="p-1 sm:p-2 font-semibold text-center text-gray-400 text-xs sm:text-sm">Num 2</div>
                <div class="p-1 sm:p-2 font-semibold text-center text-gray-400 text-xs sm:text-sm">Num 3</div>
                <div class="p-1 sm:p-2 font-semibold text-center text-gray-400 text-xs sm:text-sm">Num 4</div>
                <div class="p-1 sm:p-2 font-semibold text-center text-gray-400 text-xs sm:text-sm">Num 5</div>
            </div>
            <!-- 響應式：手機上 40px, 桌面上 60px -->
            <div id="grid-body" class="grid gap-1 min-w-0" style="grid-template-columns: 40px sm:60px repeat(5, 1fr);">
                <!-- Rows will be generated by JavaScript -->
            </div>
        </div>

        <!-- Act 3: The Interaction -->
        <div id="builder-container" class="bg-gray-800 p-4 sm:p-6 rounded-lg">
            <!-- 響應式：手機上 text-xl, 桌面上 text-2xl -->
            <h2 class="text-xl sm:text-2xl font-semibold text-center text-white mb-4">Build Your 'Nightmare Problem'</h2>
            <p class="text-center text-gray-300 mb-4">We will build a new problem that is guaranteed *not* to be on the list above by flipping the value on the diagonal.</p>
            
            <!-- The user's constructed list -->
            <div class="flex justify-center gap-1 sm:gap-2 mb-6" id="nightmare-list-display">
                <!-- Cells will be generated by JavaScript -->
            </div>

            <!-- Interactive prompt -->
            <div id="controls" class="text-center">
                <!-- 響應式：將固定的 h-16 (64px) 改為 min-h-[4.5rem] (72px)，允許其自動增高 -->
                <p id="prompt-text" class="text-base sm:text-lg text-blue-300 min-h-[4.5rem] sm:min-h-[3rem] mb-4 flex items-center justify-center"></p>
                <!-- 響應式：手機上 flex-col, 桌面上 flex-row -->
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <!-- 響應式：手機上 w-full, 桌面上 w-auto -->
                    <button id="btn-in" class="w-full sm:w-auto text-white font-bold py-3 px-8 rounded-lg bg-green-600 hover:bg-green-500 transition-all duration-200 transform hover:scale-105">
                        Choose IN (✅)
                    </button>
                    <!-- 響應式：手機上 w-full, 桌面上 w-auto -->
                    <button id="btn-out" class="w-full sm:w-auto text-white font-bold py-3 px-8 rounded-lg bg-red-600 hover:bg-red-500 transition-all duration-200 transform hover:scale-105">
                        Choose OUT (❌)
                    </button>
                </div>
            </div>
        </div>

        <!-- Act 4: The Conclusion -->
        <div id="conclusion" class="hidden text-center p-2 sm:p-6">
            <!-- 響應式：手機上 text-2xl, 桌面上 text-3xl -->
            <h2 class="text-2xl sm:text-3xl font-bold text-green-400 mb-4">It's Not on the List!</h2>
            <!-- 響應式：手機上 text-lg, 桌面上 text-xl -->
            <p class="text-lg sm:text-xl text-gray-200 mb-6">Your 'Nightmare Problem' is complete!</p>
            
            <!-- Dynamic comparison text -->
            <!-- 響應式：手機上 text-base, 桌面上 text-lg -->
            <div id="comparison-text" class="text-left text-base sm:text-lg text-gray-300 mb-6 space-y-2 max-w-md mx-auto">
                <!-- Comparison lines will be generated by JavaScript -->
            </div>

            <!-- 響應式：手機上 text-xl, 桌面上 text-2xl -->
            <p class="text-xl sm:text-2xl font-semibold text-white mb-6">
                This proves the "complete" list wasn't complete at all.
            </p>
            <!-- 響應式：手機上 text-lg, 桌面上 text-xl -->
            <p class="text-lg sm:text-xl text-blue-300 mb-8">
                The collection of all "Problems" is a <span class="font-bold">bigger infinity</span> than the collection of all "Tools" (programs).
            </p>
            
            <button id="btn-reset" class="text-black font-bold py-3 px-8 rounded-lg bg-blue-400 hover:bg-blue-300 transition-all duration-200 transform hover:scale-105">
                Run Again & (Re)break Infinity!
            </button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Constants ---
            const GRID_SIZE = 5;
            const IN = 1;
            const OUT = 0;
            const STATUS_MAP = {
                [IN]: { text: 'IN', class: 'cell-in' },
                [OUT]: { text: 'OUT', class: 'cell-out' }
            };

            // --- State ---
            let gridData = [];
            let nightmareList = [];
            let currentStep = 0;

            // --- Element References ---
            const gridBody = document.getElementById('grid-body');
            const nightmareDisplay = document.getElementById('nightmare-list-display');
            const promptText = document.getElementById('prompt-text');
            const btnIn = document.getElementById('btn-in');
            const btnOut = document.getElementById('btn-out');
            const btnReset = document.getElementById('btn-reset');
            
            const setupContainer = document.getElementById('setup');
            const listContainer = document.getElementById('list-container');
            const builderContainer = document.getElementById('builder-container');
            const conclusionContainer = document.getElementById('conclusion');
            const comparisonText = document.getElementById('comparison-text');

            // --- Functions ---

            /** Generates a new random grid */
            function createGridData() {
                gridData = [];
                for (let i = 0; i < GRID_SIZE; i++) {
                    const row = [];
                    for (let j = 0; j < GRID_SIZE; j++) {
                        row.push(Math.round(Math.random())); // Random 0 or 1
                    }
                    gridData.push(row);
                }
            }

            /** Renders the main "List of Lists" grid */
            function renderGrid() {
                gridBody.innerHTML = '';
                
                gridData.forEach((row, i) => {
                    // Add row label
                    const labelEl = document.createElement('div');
                    // 響應式：手機上 p-1 text-xs, 桌面上 p-2 text-sm
                    labelEl.className = 'p-1 sm:p-2 font-semibold text-center text-xs sm:text-sm text-gray-300 flex items-center justify-center';
                    labelEl.textContent = `List ${i + 1}`;
                    gridBody.appendChild(labelEl); // TO THIS

                    // Add cells for this row
                    row.forEach((cell, j) => {
                        const cellEl = document.createElement('div');
                        // 響應式：手機上 p-1 text-xs, 桌面上 p-2 text-sm
                        cellEl.className = `p-1 sm:p-2 font-bold text-center text-xs sm:text-sm rounded-md transition-all duration-300 ${STATUS_MAP[cell].class}`;
                        cellEl.textContent = STATUS_MAP[cell].text;

                        // Highlight the active diagonal
                        if (i === currentStep && j === currentStep) {
                            cellEl.classList.add('diagonal-active');
                        }
                        
                        gridBody.appendChild(cellEl); // TO THIS
                    });
                });
            }

            /** Renders the user's "Nightmare List" display */
            function renderNightmareList() {
                nightmareDisplay.innerHTML = '';
                for (let i = 0; i < GRID_SIZE; i++) {
                    const cellEl = document.createElement('div');
                    // 響應式：手機上 p-1 h-10 text-xs, 桌面上 p-2 h-12 text-sm
                    cellEl.className = 'w-1/5 p-1 h-10 sm:p-2 sm:h-12 font-bold text-center text-xs sm:text-sm rounded-md flex items-center justify-center';
                    
                    if (i < nightmareList.length) {
                        const status = nightmareList[i];
                        cellEl.classList.add(STATUS_MAP[status].class);
                        cellEl.textContent = STATUS_MAP[status].text;
                    } else if (i === currentStep) {
                        cellEl.classList.add('bg-blue-900', 'text-blue-200');
                        cellEl.textContent = '?';
                    } else {
                        cellEl.classList.add('cell-empty');
                        cellEl.textContent = '-';
                    }
                    nightmareDisplay.appendChild(cellEl);
                }
            }

            /** Updates the interactive prompt */
            function updatePrompt() {
                if (currentStep >= GRID_SIZE) return;

                const diagonalValue = gridData[currentStep][currentStep];
                const oppositeValue = 1 - diagonalValue;

                promptText.textContent = `List ${currentStep + 1}'s value at position ${currentStep + 1} is ${STATUS_MAP[diagonalValue].text}. To be different, you must choose...`;
                promptText.classList.remove('prompt-fade-in');
                void promptText.offsetWidth; // Trigger reflow
                promptText.classList.add('prompt-fade-in');
            }

            /** Handles the user's choice (IN or OUT) */
            function handleChoice(chosenValue) {
                if (currentStep >= GRID_SIZE) return;

                const diagonalValue = gridData[currentStep][currentStep];
                const correctChoice = 1 - diagonalValue;

                if (chosenValue === correctChoice) {
                    // --- CORRECT CHOICE ---
                    nightmareList.push(correctChoice);
                    currentStep++;
                    
                    renderNightmareList();

                    if (currentStep < GRID_SIZE) {
                        // Move to next step
                        renderGrid(); // Updates diagonal highlight
                        updatePrompt();
                    } else {
                        // --- DEMO COMPLETE ---
                        showConclusion();
                    }
                } else {
                    // --- WRONG CHOICE ---
                    const wrongButton = (chosenValue === IN) ? btnIn : btnOut;
                    wrongButton.classList.add('shake');
                    setTimeout(() => wrongButton.classList.remove('shake'), 300);
                }
            }

            /** Hides the builder and shows the final conclusion */
            function showConclusion() {
                builderContainer.classList.add('hidden');
                listContainer.classList.add('opacity-30'); // Fade out the list
                conclusionContainer.classList.remove('hidden');

                // Build the comparison text
                comparisonText.innerHTML = '';
                for (let i = 0; i < GRID_SIZE; i++) {
                    const line = document.createElement('p');
                    const nightmareVal = nightmareList[i];
                    const listVal = gridData[i][i];
                    
                    line.innerHTML = `It's different from <b>List ${i+1}</b> at position ${i+1} 
                        (<span class="${STATUS_MAP[nightmareVal].class} px-1 rounded">${STATUS_MAP[nightmareVal].text}</span> vs 
                         <span class="${STATUS_MAP[listVal].class} px-1 rounded">${STATUS_MAP[listVal].text}</span>).`;
                    comparisonText.appendChild(line);
                }
            }

            /** Resets the entire demo */
            function resetDemo() {
                nightmareList = [];
                currentStep = 0;
                
                createGridData();
                renderGrid();
                renderNightmareList();
                updatePrompt();

                builderContainer.classList.remove('hidden');
                listContainer.classList.remove('opacity-30');
                conclusionContainer.classList.add('hidden');
            }

            /** Initialize the application */
            function init() {
                // Attach event listeners
                btnIn.addEventListener('click', () => handleChoice(IN));
                btnOut.addEventListener('click', () => handleChoice(OUT));
                btnReset.addEventListener('click', resetDemo);

                // Start the demo
                resetDemo();
            }

            // Run the app
            init();
        });
    </script>
</body>
</html>
